from excel.excel import FlatDataModel

"""
以下代码：比较两部分节点是否一致，根据ST1给出ST2中最接近的点的编号，并给出距离的平方"""
st1="""
   32764  -91.9999550000      -36.1001700000      -35.4995000000    
   32765  -89.9999550000      -36.0481700000      -35.4995000000    
   32766  -87.9999550000      -35.9973120000      -35.4995000000    
   32767  -85.9999550000      -35.9475980000      -35.4995000000    
   32768  -83.9999550000      -35.8990270000      -35.4995000000    
   32769  -82.7954750000      -35.8704630000      -35.4995000000    
   32770  -89.9999550000      -36.0481700000      -32.6995000000    
   32771  -87.9999550000      -35.9973120000      -32.6995000000    
   32772  -85.9999550000      -35.9475980000      -32.6995000000    
   32773  -83.9999550000      -35.8990270000      -32.6995000000    
   32774  -82.7954750000      -35.8704630000      -32.6995000000    
   32775  -91.9999550000      -36.1001700000      -32.6995000000    
   32776  -91.9999550000      -36.1001700000      -1.40050000000    
   32777  -89.9999550000      -36.0481700000      -1.40050000000    
   32778  -87.9999550000      -35.9973120000      -1.40050000000    
   32779  -85.9999550000      -35.9475980000      -1.40050000000    
   32780  -83.9999550000      -35.8990270000      -1.40050000000    
   32781  -82.7954750000      -35.8704630000      -1.40050000000    
   32782  -91.9999550000      -36.1001700000       1.39950000000    
   32783  -89.9999550000      -36.0481700000       1.39950000000    
   32784  -87.9999550000      -35.9973120000       1.39950000000    
   32785  -85.9999550000      -35.9475980000       1.39950000000    
   32786  -83.9999550000      -35.8990270000       1.39950000000    
   32787  -82.7954750000      -35.8704630000       1.39950000000     

"""
fdm1=FlatDataModel.load_from_string(st1,['node','x','y','z'])
st2="""
   31008  -91.9999550000      -36.1001700000       1.39950000000    
   31025  -82.7954750000      -35.8704630000       1.39950000000    
   31026  -83.9999550000      -35.8990270000       1.39950000000    
   31027  -85.9999550000      -35.9475980000       1.39950000000    
   31028  -87.9999550000      -35.9973120000       1.39950000000    
   31029  -89.9999550000      -36.0481700000       1.39950000000    
   31030  -91.9999550000      -36.1001700000      -1.40050000000    
   31047  -82.7954750000      -35.8704630000      -1.40050000000    
   31048  -83.9999550000      -35.8990270000      -1.40050000000    
   31049  -85.9999550000      -35.9475980000      -1.40050000000    
   31050  -87.9999550000      -35.9973120000      -1.40050000000    
   31051  -89.9999550000      -36.0481700000      -1.40050000000    
   31988  -91.9999550000      -36.1001700000      -35.4995000000    
   32737  -82.7954750000      -35.8704630000      -35.4995000000    
   32738  -83.9999550000      -35.8990270000      -35.4995000000    
   32739  -85.9999550000      -35.9475980000      -35.4995000000    
   32740  -87.9999550000      -35.9973120000      -35.4995000000    
   32741  -89.9999550000      -36.0481700000      -35.4995000000    
   32742  -91.9999550000      -36.1001700000      -32.6995000000    
   32759  -82.7954750000      -35.8704630000      -32.6995000000    
   32760  -83.9999550000      -35.8990270000      -32.6995000000    
   32761  -85.9999550000      -35.9475980000      -32.6995000000    
   32762  -87.9999550000      -35.9973120000      -32.6995000000    
   32763  -89.9999550000      -36.0481700000      -32.6995000000    



"""
fdm2=FlatDataModel.load_from_string(st2,['node','x','y','z'])
tmp=[x for x in fdm2]
for u in fdm1:
    cx=u['x']
    cy=u['y']
    cz=u['z']
    tmp.sort(key=lambda x:(x['x']-cx)**2+(x['y']-cy)**2+(x['z']-cz)**2)
    u.data['near_node']=tmp[0]['node']
    u.data['distance']=(cx-tmp[0]['x'])**2+(cy-tmp[0]['y'])**2+(cz-tmp[0]['z'])**2
fdm1.vn.append('near_node')
fdm1.vn.append('distance')
fdm1.show_in_excel()

